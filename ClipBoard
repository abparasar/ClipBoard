import pandas as pd
import matplotlib.pyplot as plt

# Assuming you've already created this merged DataFrame
# merged: columns ['intent', 'count_a', 'count_b', 'norm_a', 'norm_b']

# Compute absolute difference for sorting
merged['abs_diff'] = abs(merged['norm_a'] - merged['norm_b'])

# Get top 20 intents with biggest shift
top_shift = merged.sort_values('abs_diff', ascending=False).head(20)

# Plot
plt.figure(figsize=(14, 6))
x = range(len(top_shift))

bar_width = 0.4

# Old distribution
plt.bar([i - bar_width/2 for i in x], top_shift['norm_a'], 
        width=bar_width, label='Old (661)', color='steelblue')

# New distribution
plt.bar([i + bar_width/2 for i in x], top_shift['norm_b'], 
        width=bar_width, label='New (708)', color='orange')

# Labels and formatting
plt.xticks(x, top_shift['intent'], rotation=90)
plt.ylabel("Normalized Frequency")
plt.title("Top 20 Intents with Largest Distribution Shift")
plt.legend()
plt.tight_layout()
plt.show()