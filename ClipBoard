import numpy as np
from scipy.stats import chisquare

# Example: Replace this with your actual 10x7 fraud counts data
fraud_counts = np.random.randint(10, 100, size=(10, 7))  # Placeholder

# Total fraud cases per score band
totals = fraud_counts.sum(axis=1)

# Overall monthly proportions
overall_monthly_proportions = fraud_counts.sum(axis=0) / fraud_counts.sum()

# Calculate expected counts per score band
expected_counts = np.array([totals[i] * overall_monthly_proportions for i in range(fraud_counts.shape[0])])

# Row-wise Chi-Square Goodness-of-Fit Tests
bands_failing = []
for i in range(fraud_counts.shape[0]):
    chi2, p = chisquare(f_obs=fraud_counts[i], f_exp=expected_counts[i])
    print(f"Score Band {i + 1}: Chi-Square = {chi2:.4f}, P-Value = {p:.4f}")
    if p <= 0.05:
        bands_failing.append(i + 1)

# Summary of failing bands
if bands_failing:
    print(f"\nScore bands failing the constant fraud rate assumption: {bands_failing}")
else:
    print("\nAll score bands have consistent fraud rates across months (no significant differences).")