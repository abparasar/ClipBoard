import pandas as pd
import os

# Example row function: takes a single value and returns 2 outputs
def my_func(x):
    return x * 2, x + 5

# --- Step 1: Load existing progress if available ---
if os.path.exists("progress.xlsx"):
    df = pd.read_excel("progress.xlsx")
else:
    df = pd.DataFrame({"col": [1, 2, 3, 4, 5]})  # your initial data
    df["col1"] = None
    df["col2"] = None

# --- Step 2: Process in chunks ---
chunk_size = 2  # change as needed

for i in range(0, len(df), chunk_size):
    # Select only rows in this chunk that are not yet processed
    mask = df.iloc[i:i+chunk_size]["col1"].isna()
    if mask.any():
        idx = df.iloc[i:i+chunk_size][mask].index

        # Apply your function on df['col']
        results = df.loc[idx, "col"].apply(my_func).tolist()

        # Unpack into col1, col2
        df.loc[idx, ["col1", "col2"]] = results

        # Save checkpoint
        df.to_excel("progress.xlsx", index=False)
        print(f"âœ… Saved progress up to row {i+chunk_size}")