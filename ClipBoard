import pandas as pd
from openpyxl import Workbook

# Load Excel files
time_a = pd.read_excel("time_A.xlsx")
time_b = pd.read_excel("time_B.xlsx")

# Rename for clarity
time_a.columns = ['Name', 'Rank_A']
time_b.columns = ['Name', 'Rank_B']

# Merge based on Name
merged = pd.merge(time_b, time_a, on='Name', how='left')

# Define status with arrow symbols
def get_status(row):
    if pd.isna(row['Rank_A']):
        return "🆕 New"
    diff = row['Rank_A'] - row['Rank_B']
    if diff > 0:
        return f"⬆️ {diff}"
    elif diff < 0:
        return f"⬇️ {abs(diff)}"
    else:
        return "↔️ Same"

# Apply status
merged['Status'] = merged.apply(get_status, axis=1)

# Select top 25 by Rank_B
top25 = merged.sort_values('Rank_B').head(25)

# Create Excel output
wb = Workbook()
ws = wb.active
ws.title = "Top 25 Movement"

# Header row
ws.append(['Name', 'Rank_B', 'Status'])

# Fill rows
for _, row in top25.iterrows():
    ws.append([row['Name'], row['Rank_B'], row['Status']])

# Save workbook
wb.save("Top25_Movement.xlsx")