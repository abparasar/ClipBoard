import subprocess
import time

def run_powershell_command(command):
    """Run a PowerShell command and return the output."""
    result = subprocess.run(
        ["powershell", "-Command", command],
        capture_output=True,
        text=True
    )
    return result.stdout

def get_chrome_pids():
    """Get a list of all Chrome process IDs using PowerShell."""
    command = 'Get-Process -Name chrome | Select-Object -ExpandProperty Id'
    output = run_powershell_command(command)
    # Split the output into a list of PIDs and filter out empty strings
    pids = [int(pid) for pid in output.split() if pid.isdigit()]
    return pids

def close_chrome_pids(pids):
    """Close all Chrome processes with the given PIDs using PowerShell."""
    for pid in pids:
        command = f'Stop-Process -Id {pid} -Force'
        run_powershell_command(command)
        print(f'Closed Chrome process with PID {pid}')

# Open a new Chrome window (adjust path if necessary)
subprocess.Popen(["C:/Program Files/Google/Chrome/Application/chrome.exe", "--new-window", "https://www.example.com"])

# Wait for a while to ensure the window is opened
time.sleep(10)

# Get all Chrome PIDs
chrome_pids = get_chrome_pids()

# Close the Chrome processes
close_chrome_pids(chrome_pids)